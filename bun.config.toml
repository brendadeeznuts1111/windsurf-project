# Bun v1.3 Test Configuration
# bun.config.toml - Optimized for Odds Protocol testing

[test]
# Enable concurrent testing by default (Bun v1.3 feature)
concurrent = true

# Test timeout configuration
timeout = 30000

# Coverage configuration
coverage = {
  enabled = true,
  provider = "v8",
  reporter = ["text", "lcov", "html"],
  include = [
    "packages/*/src/**/*.ts",
    "!packages/*/src/**/*.test.ts",
    "!packages/*/src/**/*.spec.ts"
  ],
  exclude = [
    "node_modules/**",
    "dist/**",
    "**/*.d.ts"
  ]
}

# Test file patterns
testMatch = [
  "**/__tests__/**/*.test.ts",
  "**/*.test.ts",
  "**/*.spec.ts"
]

# Ignore patterns
ignore = [
  "node_modules/**",
  "dist/**",
  "coverage/**"
]

# Preload test setup
preload = ["./scripts/test-setup.ts"]

# Environment variables for testing
env = {
  NODE_ENV = "test",
  BUN_DEBUG = "0",
  BUN_TEST = "1"
}

# Test hooks configuration
[test.hooks]
# Setup before all tests
beforeAll = "./scripts/test-before-all.ts"

# Cleanup after all tests
afterAll = "./scripts/test-after-all.ts"

# Performance testing configuration
[performance]
# Enable performance monitoring
enabled = true

# Performance thresholds (in milliseconds)
thresholds = {
  "network-request" = 5000,
  "websocket-message" = 100,
  "hash-operation" = 10,
  "stream-processing" = 1000
}

# Benchmark configuration
[benchmark]
# Enable benchmarking
enabled = true

# Benchmark iterations
iterations = 1000

# Warmup iterations
warmup = 100

# Report format
reporter = ["json", "text"]

# Concurrent testing configuration
[concurrent]
# Maximum concurrent test workers
maxWorkers = 4

# Worker timeout
workerTimeout = 60000

# Memory limit per worker (MB)
memoryLimit = 512

# Retry configuration
[retry]
# Enable retry on failure
enabled = true

# Maximum retry attempts
maxAttempts = 3

# Retry delay (ms)
delay = 1000

# Exponential backoff
backoff = "exponential"

# Reporting configuration
[reporting]
# Enable detailed reports
enabled = true

# Report formats
formats = ["json", "junit", "html"]

# Output directory
outputDir = "./test-results"

# Include performance metrics
includePerformance = true

# Include coverage reports
includeCoverage = true

# Integration test configuration
[integration]
# Enable integration tests
enabled = true

# Test server configuration
server = {
  port = 3001,
  host = "localhost",
  timeout = 30000
}

# Database configuration for integration tests
database = {
  url = "postgresql://test:test@localhost:5432/odds_test",
  poolSize = 5,
  timeout = 5000
}

# External service configuration
services = {
  mockApi = "http://localhost:3002",
  externalApi = "https://api.example.com"
}

# WebSocket testing configuration
[websocket]
# Enable WebSocket tests
enabled = true

# Test server configuration
server = {
  port = 3003,
  protocols = ["wss", "ws"],
  compression = true
}

# Connection limits
maxConnections = 100
connectionTimeout = 5000

# Message testing
messageSize = 1024
messageRate = 1000

# Network testing configuration
[network]
# Enable network tests
enabled = true

# Test endpoints
endpoints = [
  "httpbin.org:80",
  "api.github.com:443",
  "example.com:80"
]

# Connection settings
timeout = 10000
retries = 3
concurrentRequests = 10

# Security testing configuration
[security]
# Enable security tests
enabled = true

# Vulnerability scanning
scanDependencies = true

# Security thresholds
maxVulnerabilities = 0
allowedSeverities = ["low"]

# Code quality testing
[quality]
# Enable code quality checks
enabled = true

# ESLint configuration
eslint = {
  configFile = ".eslintrc.js",
  maxWarnings = 0
}

# Type checking
typecheck = {
  enabled = true,
  strict = true
}

# Code coverage thresholds
coverage = {
  statements = 80,
  branches = 75,
  functions = 80,
  lines = 80
}
