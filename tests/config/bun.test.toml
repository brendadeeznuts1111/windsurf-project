# Bun v1.3 Comprehensive Testing Configuration
# bun.test.toml - Advanced testing setup for Odds Protocol

[test]
# Enable concurrent testing by default
concurrent = true

# Maximum concurrent tests (default is 20)
maxConcurrency = 10

# Randomize test order to catch dependencies
randomize = true

# Test file patterns - Updated for standardized structure
testMatch = [
  "**/tests/**/*.test.ts",
  "**/tests/**/*.spec.ts",
  "**/__tests__/**/*.test.ts",
  "**/*.test.ts",
  "**/*.spec.ts",
  "property-tests/**/*.test.ts",
  "packages/testing/src/contracts/**/*.test.ts"
]

# Files that should run concurrently by default
concurrentTestGlob = [
  "**/tests/unit/**/*.test.ts",
  "**/tests/integration/**/*.test.ts",
  "**/tests/performance/**/*.test.ts",
  "**/integration/**/*.test.ts",
  "**/*-concurrent.test.ts",
  "property-tests/**/*.test.ts",
  "packages/testing/src/contracts/**/*.test.ts"
]

# Ignore patterns
ignore = [
  "node_modules/**",
  "dist/**",
  "coverage/**",
  "**/*.d.ts"
]

# Preload test setup
preload = ["./scripts/test-setup.ts"]

# Environment variables for testing
env = {
  NODE_ENV = "test",
  BUN_DEBUG = "0",
  BUN_TEST = "1",
  CI = "false"
}

# Coverage configuration
[coverage]
enabled = true
provider = "v8"
reporter = ["text", "lcov", "html", "json"]

# Include patterns for coverage
include = [
  "packages/*/src/**/*.ts",
  "!packages/*/src/**/*.test.ts",
  "!packages/*/src/**/*.spec.ts",
  "!packages/*/src/**/*.d.ts"
]

# Exclude patterns from coverage
exclude = [
  "node_modules/**",
  "dist/**",
  "coverage/**",
  "**/*.config.ts",
  "**/*.setup.ts",
  "**/__mocks__/**"
]

# Coverage thresholds
thresholds = {
  statements = 80,
  branches = 75,
  functions = 80,
  lines = 80
}

# Paths to exclude from coverage calculation
coveragePathIgnorePatterns = [
  "node_modules",
  "dist",
  "coverage",
  "**/*.test.ts",
  "**/*.spec.ts",
  "**/__tests__/**",
  "**/config/**"
]

# Performance testing configuration
[performance]
enabled = true

# Performance thresholds (in milliseconds)
thresholds = {
  "network-request" = 5000,
  "websocket-message" = 100,
  "hash-operation" = 10,
  "stream-processing" = 1000,
  "async-operation" = 500
}

# Benchmark configuration
[benchmark]
enabled = true
iterations = 1000
warmup = 100
reporter = ["json", "text"]

# Retry configuration
[retry]
enabled = true
maxAttempts = 3
delay = 1000
backoff = "exponential"

# Reporting configuration
[reporting]
enabled = true
formats = ["json", "junit", "html"]
outputDir = "./test-results"
includePerformance = true
includeCoverage = true

# VS Code integration
[vscode]
enabled = true
testExplorer = true
debugSupport = true
inlineErrors = true

# Type testing configuration
[typeTesting]
enabled = true
strict = true
checkExpectTypeOf = true
typescriptConfig = "./tsconfig.json"

# Snapshot testing
[snapshots]
enabled = true
updateSnapshots = false
inlineSnapshots = true
automaticIndentation = true

# CI/CD configuration
[ci]
strict = true
failOnOnly = true
failOnNewSnapshots = true
timeout = 60000
parallel = true

# Mock configuration
[mocks]
autoClear = false
restoreMocks = false
clearAllMocks = false

# Test execution order
[execution]
order = "random"
seed = null
shuffleFiles = true
shuffleTests = true

# Hook configuration
[hooks]
beforeAllTimeout = 30000
afterAllTimeout = 30000
beforeEachTimeout = 5000
afterEachTimeout = 5000

# Concurrent test limitations
[concurrent]
disableAssertions = false
disableSnapshots = true
sequentialHooks = true

# Integration testing
[integration]
enabled = true
server = {
  port = 3001,
  host = "localhost",
  timeout = 30000
}
database = {
  url = "postgresql://test:test@localhost:5432/odds_test"
}
services = {
  mockApi = "http://localhost:3002"
}

# Property testing
[propertyTesting]
enabled = true
iterations = 100
seed = null
shrink = true

# Error reporting
[errors]
detailed = true
stackTraces = true
asyncStackTraces = true
sourceMaps = true

# Output formatting
[output]
verbose = false
compact = false
colors = true
progress = true
summary = true

# File watching for development
[watch]
enabled = false
ignore = ["node_modules", "dist", "coverage"]
debounce = 100

# Memory and performance limits
[limits]
memory = "512MB"
timeout = 30000
maxWorkers = 4
workerTimeout = 60000

# Security testing
[security]
enabled = true
scanDependencies = true
maxVulnerabilities = 0
allowedSeverities = ["low"]

# Accessibility testing
[accessibility]
enabled = true
standards = ["WCAG2.1"]
level = "AA"

# Load testing
[load]
enabled = true
concurrentUsers = 100
duration = "30s"
rampUp = "10s"
